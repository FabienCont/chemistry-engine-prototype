!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=17)}([function(t,e,n){"use strict";n.r(e),function(t){var i=n(2);n.d(e,"destroy",function(){return i.a});var r=n(3);n.d(e,"render",function(){return r.a});var s=n(4);n.d(e,"setup",function(){return s.a});var o=n(5);n.d(e,"start",function(){return o.a});var a=n(6);n.d(e,"update",function(){return a.a}),void 0!==t.hot&&t.hot.accept(["./destroy.js","./render.js","./setup.js","./start.js","./update.js"])}.call(this,n(1)(t))},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,n){"use strict";function i(){console.log("destroy loading scene"),console.log("-------"),delete this.state.redirect}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";function i(){this.context.fillStyle="#181a1f",this.context.fillRect(0,0,this.size.width,this.size.height),this.context.font="16px Courier New",this.context.textAlign="start",this.context.textBaseline="top",this.context.fillStyle="#6b717d",this.context.fillText("/ Theatre",8,8),this.context.fillStyle="#d7dae0",this.context.fillText("$ preloading assets...",8,32),!1===this.preloading&&(this.context.fillText("$ preloading completed",8,56),this.context.fillText("$ loading demo scene...",8,80))}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";function i(){console.log("setup loading scene")}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";function i(){console.log("start loading scene"),this.state.redirect=!1}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";function i(){var t=this;!1===this.preloading&&!1===this.state.redirect&&(setTimeout(function(){t.load("demo")},1e3),this.state.redirect=!0)}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";n.r(e),function(t){var i=n(8);n.d(e,"destroy",function(){return i.a});var r=n(12);n.d(e,"render",function(){return r.a});var s=n(10);n.d(e,"setup",function(){return s.a});var o=n(9);n.d(e,"start",function(){return o.a});var a=n(11);n.d(e,"update",function(){return a.a}),void 0!==t.hot&&t.hot.accept(["./destroy.js","./render.js","./setup.js","./start.js","./update.js"])}.call(this,n(1)(t))},function(t,e,n){"use strict";function i(){delete this.world,delete this.grid,console.log("destroy demo scene"),console.log("-------")}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,s=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(t,e){this.components={},this.name=t,this.add=function(t){var e=this;!1===Array.isArray(t)&&(t=[t]),t.forEach(function(t){e.components[t.name]=t})},this.get=function(t){return this.components[t]},this.has=function(t){!1===Array.isArray(t)&&(t=[t]);for(var e=0,n=t.length;e<n;e+=1){var i=t[e],r=i.replace("not:",""),s=i!==r;if(this.components.hasOwnProperty(r)===s)return!1}return!0},this.remove=function(t){!1===Array.isArray(t)&&(t=[t]);for(var e=0,n=t.length;e<n;e+=1){var i=t[e];!0===this.components.hasOwnProperty(i)&&delete this.components[i]}},this.add(e)}function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.name="camera",this.camera=t,this.opacity=e}function o(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.name="position",this.x=t,this.y=e,this.z=n}function a(t){this.name="images",this.parts=t,this.parts.forEach(function(t){var e=t.destination,n=t.frame,i=t.framerate,r=t.frames,s=t.opacity,o=t.source;t.source=o,t.frames=r||[[0,0,32,32]],t.frame=n||0,t.framerate=i||8,t.destination=e||[0,0,0,32,32],t.opacity=s||1,t.elapsed=0})}function c(t){this.name="statesSensibility",this.states=t}function u(t){this.name="states",this.states=t}function h(t,e){return Math.random()*(e-t)+t}function l(t,e){var n=this;return new r("lake_"+(10*e+t),[new s(this.camera),new o(32*t,32*e,0),new a([{source:this.assets.images.common.lake(),frames:[[0,0,32,32]],frame:0,destination:[0,0,0,32,32]}]),new c({cold:{duration:5e3+h(-200,200),elapsed:0,modified:!1,callback:function(i){var r=d.call(n,t,e);n.world.add(r),n.grid[t+e*n.size.width/32]=r,n.world.remove(i)}}}),new u(["water"])])}function d(t,e){var n=this;return new r("ices_"+(10*e+t),[new s(this.camera),new o(32*t,32*e,0),new a([{source:this.assets.images.common.ice(),frames:[[0,0,32,32]],frame:0,destination:[0,0,0,32,32]}]),new c({fire:{duration:1e3+h(-100,100),elapsed:0,modified:!1,callback:function(i){var r=l.call(n,t,e);n.world.add(r),n.grid[t+e*n.size.width/32]=r,n.world.remove(i)}}}),new u(["cold"])])}function f(t,e){var n=this;return new r("lava_"+(10*e+t),[new s(this.camera),new o(32*t,32*e,0),new a([{source:this.assets.images.common.lava(),frames:[[0,0,32,32]],frame:0,destination:[0,0,0,32,32]}]),new c({cold:{duration:2e3+h(-100,100),elapsed:0,modified:!1,callback:function(i){var r=A.call(n,t,e);n.world.add(r),n.grid[t+e*n.size.width/32]=r,n.world.remove(i)}},water:{duration:3e3+h(-100,100),modified:!1,elapsed:0,callback:function(i){var r=A.call(n,t,e);n.world.add(r),n.grid[t+e*n.size.width/32]=r,n.world.remove(i)}}}),new u(["fire"])])}function A(t,e){var n=this;return new r("rock_"+(10*e+t),[new s(this.camera),new o(32*t,32*e,0),new a([{source:this.assets.images.common.rock(),frames:[[0,0,32,32]],frame:0,destination:[0,0,0,32,32]}]),new c({fire:{duration:6e3+h(-100,100),elapsed:0,modified:!1,callback:function(i){var r=f.call(n,t,e);n.world.add(r),n.grid[t+e*n.size.width/32]=r,n.world.remove(i)}}})])}function m(){console.log("start demo scene"),this.world=new function(t){this.entities={},this.add=function(t){var e=this;!1===Array.isArray(t)&&(t=[t]),t.forEach(function(t){e.entities[t.name]=t})},this.get=function(t){return this.entities[t]},this.remove=function(t){!1===Array.isArray(t)&&(t=[t]);for(var e=0,n=t.length;e<n;e+=1){var i=t[e],r=i.name||i;!0===this.entities.hasOwnProperty(r)&&delete this.entities[r]}},this.system=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.entities,s={};Object.entries(r).forEach(function(t){var n=i(t,2),r=n[0],o=n[1];!0===o.has(e)&&(s[r]=o)}),n.call(t,s)}}(this);var t=function(){var t=[f,d,l,A];return t[Math.floor(Math.random()*Math.floor(t.length))]};this.grid=[];for(var e=0;e<this.size.height/32;e++)for(var n=0;n<this.size.width/32;n++){var r=t().call(this,n,e);this.grid.push(r),this.world.add(r)}}n.d(e,"a",function(){return m})},function(t,e,n){"use strict";function i(t){return function(e){return Math.pow(e,t)}}function r(t){return function(e){return 1-i(t)(1-e)}}function s(){this.camera=new function(t,e,n){var i=[],s={current:!1,duration:0,easing:null,elapsed:0,force:{x:0,y:0},shift:{x:0,y:0}};this.position={x:0,y:0},this.size={width:e,height:n},this.add=function(t){for(var e=0,n=i.length-1;n>=0;n-=1){var r=i[n];if(t.destination.z>=r.destination.z){e=n+1;break}}i.splice(e,0,t)},this.idle=function(){s={current:!1,duration:0,easing:null,elapsed:0,force:{x:0,y:0},shift:{x:0,y:0}}},this.render=function(){var e=this;i.forEach(function(n){var i=n.destination,r=n.frame,o=n.opacity,a=n.source;if(o>0&&!0===e.visible(i.x,i.y,r.width,r.height)){var c=t.globalAlpha;t.globalAlpha=o,t.drawImage(a,r.x,r.y,r.width,r.height,i.x-(e.position.x+s.shift.x),i.y-(e.position.y+s.shift.y),i.width,i.height),t.globalAlpha=c}}),i=[]},this.set=function(t,e){this.position.x=t,this.position.y=e},this.shake=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){return function(e){return t(1-e)}}(r(2));this.idle(),s.force={x:t,y:e},s.current=!0,s.duration=n,s.easing=i},this.update=function(t){if(!1!==s.current)if(s.elapsed+t>=s.duration)this.idle();else{s.elapsed+=t;var e=s.easing(s.elapsed/s.duration),n=2*Math.random()*Math.PI;s.shift.x=Math.round(Math.cos(n)*s.force.x*e),s.shift.y=Math.round(Math.sin(n)*s.force.y*e)}},this.visible=function(t,e,n,i){var r=this.position.x+s.shift.x,o=this.position.y+s.shift.y,a=this.size.width,c=this.size.height;return!(t+n<=r||t>=r+a||e+i<=o||e>=o+c)}}(this.context,this.size.width,this.size.width),console.log("setup demo scene")}n.d(e,"a",function(){return s})},function(t,e,n){"use strict";function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,s=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(t){var e=this;Object.entries(t).forEach(function(t){var n=i(t,2),r=(n[0],n[1]),s=r.get("position");(function(t){for(var e=t.x/32+t.y/32*this.size.width/32,n=[],i=[-10,-1,1,10],r=0,s=i.length;r<s;r++)this.grid[e-i[r]]&&n.push(this.grid[e-i[r]]);return n}).call(e,s).forEach(function(t){var e=t.get("statesSensibility");if(e){var n=r.get("states");Object.entries(e.states).forEach(function(t){var e=i(t,2),r=e[0],s=e[1];n.states.forEach(function(t){t==r&&(s.modified=!0)})})}})})}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,s=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(t){var e=this;Object.entries(t).forEach(function(t){var n=s(t,2),i=(n[0],n[1]),r=i.get("statesSensibility");Object.values(r.states).forEach(function(t,n){0==t.modified?t.elapsed=0:(t.elapsed+=e.delta.update,t.elapsed>t.duration&&t.callback.call(e,i),t.modified=!1)})})}function a(){this.camera.update(this.delta.update),this.world.system(["statesSensibility"],o),this.world.system(["position","states"],r)}n.d(e,"a",function(){return a})},function(t,e,n){"use strict";function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,s=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(t){var e=this;Object.entries(t).forEach(function(t){var n=i(t,2),r=(n[0],n[1]),s=r.get("camera"),o=r.get("images"),a=r.get("position");o.parts.forEach(function(t){var n=t.destination,i=t.frame,r=t.framerate,o=t.frames,c=t.opacity,u=t.source;if(o.length>1){t.elapsed+=e.delta.render;for(var h=1e3/r;t.elapsed>=h;)t.elapsed-=h,t.frame=i===o.length-1?0:i+1}s.camera.add({source:u,frame:{x:o[t.frame][2]*o[t.frame][0],y:o[t.frame][3]*o[t.frame][1],width:o[t.frame][2],height:o[t.frame][3]},destination:{x:a.x+n[0],y:a.y+n[1],z:a.z+n[2],width:n[3],height:n[4]},opacity:s.opacity*c})})})}function s(){this.context.fillStyle="#d7dae0",this.context.fillRect(0,0,this.size.width,this.size.height),this.world.system(["images","position"],r),this.camera.render()}n.d(e,"a",function(){return s})},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAACSSURBVEhL7ZPBDYAgDEXdfwOvbsUGhilMhAh+2qJtORhJ3qlt/iMUljXEoUwBx7LtGWhYKKEnuVJP6IBQbEHJHVYgnOsVtKDONToIQZtocaCAC1I7bgI5Qudgl0wyXKBgCrr8TZC+Qg0MtDwScIlkEXC4ItnhswPB4bbk4QKOKehSBOklkFwzCrLAHsTx9R2EeABvjj2sK3u4nQAAAABJRU5ErkJggg=="},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAADnSURBVEhL7ZTbDcMgDEVJl8pInSm/3aYjZIOqQ1Q1sWUIBgeCUfrRI6TwML5+oEzu8XJllvlGswL354dmG9J+WtY3TStI3OmAGNh7AbyG4k0udNBhyMDQNYICVDJz74xxWSSUwThCk+uRbxGQTkKT47P4cmfp8gKG7F7ROE4KQHTxoN19hZErSsRxyXBO0JwBq+q32Kw5RvCLg9YqYGZQhCwcwSgB5ucF9McGRwcCymVEaTjuX12iUnT1GGSgt8EfJMf6MouSqP9VwCe2SDz2VAlcZQRsOU6/k79ACWgvDmryCPzDce4LS5J8Q8WEKOUAAAAASUVORK5CYII="},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAEOSURBVEhL3Y1RksMwCEP35rn6AlJlxXWdJs60O/t+AIHET8d2HjpfeNuibk7gLjRQOrhGh2ZI3hXd6GDVwUUdzB4Ivz+ElzJkwJMZoqD6gGrp7OyGPYoWeWJAHMKLB67ooJXSl/CQzL39QaCczP1HDwAWAeeC0tvIInt7UvqOoXgIXBV59GACLIJqgVHi9QfsnkBawFES5lvwwI88yPKnHrh/iB+0B5LeZGLx1e5BgHERj8qiWeoKSAs4SkJT4o6hOKHCEo6S0JTY0GrIcNVZmCvJd4e4UXTi0oMhnhZ87wHEAOMp3NUeBN4H3TghkwxX+gfXoL/QyJVmgcU1GFFQQRFcLqAQBqLciKdv2/YLtt5Wf0v6MYYAAAAASUVORK5CYII="},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAFZSURBVFhHzZcxDsIwDEXbXoALdORqTHCBbmxcACaux8qAxA76VV25bpzYSYp4Eipp3Z//nWRo+x7On6Yi18utOQ3HaZSmm65BIKaBZ7HnVmYDHjGq9STVDC864DHhmTwEzbUwcOh3KxPa2GM2RnQP1AJmES6Ey4AU0roTAzVUh2t2B7REEkwia/k4aIAnQTEfewi9J82sDFiTESlzmh7dL9qEXFwasXbNZAATWQRlWi09uD9e47WoAxrW9DBYbEB2h1LH0nNUAxC1ipTg6sAWhjbZAx7+w4B111rBUtExSzF3wLK+VlEP1ZYgd4OuDFDKXxxBkNUBzxqnKFoCmNCMWE12/AR4UmECzzJBO1Q/doA/8IgCS30sWEcCnvQ5SKM0HjtAk/OiGoZi3YE+fvMm5MX4r5nJMSaNkAbut89+n/w4xQtShMMFvSSPoTVxzuQgaoCS54qnaZov2s6Vt7NHJhkAAAAASUVORK5CYII="},function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"loading",function(){return a}),n.d(i,"demo",function(){return c});var r=[{name:"lake",scope:"common",type:"image",source:n(13)},{name:"ice",scope:"common",type:"image",source:n(14)},{name:"rock",scope:"common",type:"image",source:n(15)},{name:"lava",scope:"common",type:"image",source:n(16)}];function s(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o=[].concat(s([]),s(r),s([])),a=n(0),c=n(7);new function(t){var e=t.assets,n=t.container,i=t.scenes,r=t.size,s=t.expose||!1,o=t.framerate||60,a=t.sharp||!1,c=t.speed||1,u=null,h=!1;this.preloading=!1,this.scenes=i,this.size=r,this.state={},this.version="0.32.0",this.load=function(t){u=t},this.restart=function(){h=!0},function(){var t=this,i=new function(t,e,n,i){var r=document.createElement("canvas"),s=r.getContext(t),o=window.devicePixelRatio||1;r.setAttribute("id",e),r.setAttribute("height",o*i),r.setAttribute("width",o*n),r.style.height=i+"px",r.style.width=n+"px",s.scale(o,o),this.context=s,this.element=r,this.sharp=function(){this.element.style.imageRendering="-moz-crisp-edges",this.element.style.imageRendering="-webkit-crisp-edges",this.element.style.imageRendering="crisp-edges",this.element.style.imageRendering="pixelated",this.context.imageSmoothingEnabled=!1}}("2d","theatre",this.size.width,this.size.height);!0===a&&i.sharp(),n.appendChild(i.element),this.container=n,this.context=i.context,this.element=i.element,this.assets={},this.delta={},this.delta.render=0,this.delta.update=0,this.scene=this.scenes.loading,this.scene.setup.call(this),this.scene.start.call(this);var r=new function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,i=null,r=null;this.framerate=t,this.speed=e,this.render=function(t){var e=Date.now();null!==i&&t(e-i),requestAnimationFrame(this.render.bind(this,t)),i=e},this.update=function(t){var e=Date.now();for(null!==r&&(n+=e-r);n>=1e3/this.framerate/this.speed;)n-=1e3/this.framerate/this.speed,t(1e3/this.framerate);r=e,setTimeout(this.update.bind(this,t),1e3/Math.max(this.framerate,60))}}(o,c);r.update(function(e){return t.delta.update=e,t.scene.update.call(t),!0===h?(t.scene.start.call(t),void(h=!1)):null!==u?(t.scene.destroy.call(t),t.scene=t.scenes[u],t.scene.setup.call(t),t.scene.start.call(t),void(u=null)):void 0}),r.render(function(e){t.delta.render=e,t.scene.render.call(t)}),function(t,e){var n=[];t.forEach(function(t){var e=new Promise(function(e,n){if("dataset"===t.type&&(t.getter=function(){return t.source},e(t)),"image"===t.type){var i=new Image;i.src=t.source,i.onload=function(){t.getter=function(){return i},e(t)}}else if("sound"===t.type){var r=new Audio(t.source);r.oncanplaythrough=function(){t.getter=function(){return r.cloneNode()},e(t)}}});n.push(e)}),Promise.all(n).then(e)}(e,function(e){e.forEach(function(e){void 0===t.assets[e.type+"s"]&&(t.assets[e.type+"s"]={}),void 0===t.assets[e.type+"s"][e.scope]&&(t.assets[e.type+"s"][e.scope]={}),t.assets[e.type+"s"][e.scope][e.name]=e.getter}),t.preloading=!1}),this.loop=r,this.preloading=!0}.call(this,t),!0===s&&(window.theatre=this)}({assets:o,container:document.body,expose:!0,scenes:i,sharp:!0,size:{width:320,height:288}})}]);
//# sourceMappingURL=index.js.map